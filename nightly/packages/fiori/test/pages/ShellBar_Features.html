<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>ShellBar Feature Toggle</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<script data-ui5-config type="application/json">
		{
			"rtl": false
		}
	</script>
	<style>
		body {
			font-family: "72", "72full", Arial, Helvetica, sans-serif;
			margin: 0;
			padding: 0;
			background: var(--sapBackgroundColor);
		}

		.controls {
			position: sticky;
			top: 0;
			z-index: 1000;
			padding: 1rem;
			box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
			display: flex;
			flex-wrap: wrap;
			gap: 1rem;
			align-items: center;
		}

		.control-group {
			display: flex;
			align-items: center;
			gap: 0.5rem;
		}

		.control-section {
			width: 100%;
			padding: 0.5rem;
			border-top: 2px solid #e0e0e0;
		}

		.control-section h3 {
			margin: 0.5rem 0;
			font-size: 0.9rem;
			color: #354a5f;
			text-transform: uppercase;
		}

		.shellbar-container {
			margin: 2rem 0;
			background: white;
		}

		h1 {
			text-align: center;
			padding: 2rem;
			margin: 0;
			background: #354a5f;
			color: white;
		}

		.info {
			padding: 1rem;
			background: #fef7e4;
			border-left: 4px solid #e9730c;
			margin: 1rem;
		}

		.spacer {
			height: 2rem;
		}
	</style>
  <script type="module" crossorigin src="/webcomponents/nightly/assets/bundle.esm-CNuZVGAr.js"></script>
</head>
<body>
	<h1>ShellBar Feature Toggle</h1>

	<div class="controls">
		<!-- Theme Selection -->
		<div class="control-group">
			<ui5-label>Theme:</ui5-label>
			<ui5-select id="themeSelect" style="width: 250px;">
				<ui5-option value="sap_horizon" selected>Horizon (Morning)</ui5-option>
				<ui5-option value="sap_horizon_dark">Horizon Dark (Evening)</ui5-option>
				<ui5-option value="sap_horizon_hcb">Horizon High Contrast Black</ui5-option>
				<ui5-option value="sap_horizon_hcw">Horizon High Contrast White</ui5-option>
				<ui5-option value="sap_fiori_3">Fiori 3 (Quartz Light)</ui5-option>
				<ui5-option value="sap_fiori_3_dark">Fiori 3 Dark (Quartz Dark)</ui5-option>
				<ui5-option value="sap_fiori_3_hcb">Fiori 3 High Contrast Black</ui5-option>
				<ui5-option value="sap_fiori_3_hcw">Fiori 3 High Contrast White</ui5-option>
			</ui5-select>
		</div>

		<!-- Basic Features -->
		<div class="control-group">
			<ui5-label>Notifications:</ui5-label>
			<ui5-switch id="toggleNotifications"></ui5-switch>
		</div>

		<div class="control-group">
			<ui5-label>Product Switch:</ui5-label>
			<ui5-switch id="toggleProductSwitch"></ui5-switch>
		</div>

		<div class="control-group">
			<ui5-label>Profile:</ui5-label>
			<ui5-switch id="toggleProfile" checked></ui5-switch>
		</div>

		<div class="control-group">
			<ui5-label>Assistant:</ui5-label>
			<ui5-switch id="toggleAssistant"></ui5-switch>
		</div>

		<div class="control-group">
			<ui5-label>Start Button:</ui5-label>
			<ui5-switch id="toggleStartButton"></ui5-switch>
		</div>

		<div class="control-group">
			<ui5-label>Notifications Count:</ui5-label>
			<ui5-input id="notificationsCount" value="" placeholder="e.g. 5, 99+"></ui5-input>
		</div>

		<!-- Search Features -->
		<div class="control-section">
			<ui5-title>Search</ui5-title>
			<div style="display: flex; gap: 1rem; flex-wrap: wrap;">
				<div class="control-group">
					<ui5-label>Search Field:</ui5-label>
					<ui5-switch id="toggleSearchField"></ui5-switch>
				</div>
				<div class="control-group">
					<ui5-label>Search Type:</ui5-label>
					<ui5-select id="searchType" style="width: 200px;">
						<ui5-option value="input" selected>ui5-input</ui5-option>
						<ui5-option value="shellbar-search">ui5-shellbar-search</ui5-option>
					</ui5-select>
				</div>
			</div>
		</div>

		<!-- Content Features -->
		<div class="control-section">
			<ui5-title>Content Items (Overflow Test)</ui5-title>
			<div style="display: flex; gap: 1rem; flex-wrap: wrap;">
				<div class="control-group">
					<ui5-label>Content Items:</ui5-label>
					<ui5-switch id="toggleContent" checked></ui5-switch>
				</div>
				<div class="control-group">
					<ui5-label>Show Spacer:</ui5-label>
					<ui5-switch id="toggleSpacer"></ui5-switch>
				</div>
			</div>
		</div>

		<!-- Custom Items Features -->
		<div class="control-section">
			<ui5-title>Custom Items</ui5-title>
			<div style="display: flex; gap: 1rem; flex-wrap: wrap;">
				<div class="control-group">
					<ui5-label>Custom Items:</ui5-label>
					<ui5-switch id="toggleItems" checked></ui5-switch>
				</div>
				<div class="control-group">
					<ui5-label>More Items:</ui5-label>
					<ui5-switch id="toggleMoreItems"></ui5-switch>
				</div>
			</div>
		</div>

		<!-- Branding Mode -->
		<div class="control-section">
			<ui5-title>Branding</ui5-title>
			<div style="display: flex; gap: 1rem; flex-wrap: wrap;">
				<div class="control-group">
					<ui5-label>Branding Mode:</ui5-label>
					<ui5-select id="brandingMode" style="width: 250px;">
						<ui5-option value="branding" selected>Branding Slot (New)</ui5-option>
						<ui5-option value="legacy">Logo + Primary Title (Legacy)</ui5-option>
					</ui5-select>
				</div>
				<div class="control-group">
					<ui5-label>Show Secondary Title:</ui5-label>
					<ui5-switch id="toggleSecondaryTitle" checked></ui5-switch>
				</div>
				<div class="control-group">
					<ui5-label>Menu Items:</ui5-label>
					<ui5-switch id="toggleMenuItems" disabled></ui5-switch>
					<span style="font-size: 0.8rem; color: #666;">(requires Legacy mode)</span>
				</div>
			</div>
		</div>
	</div>

	<div class="info">
		<strong>How to use:</strong> Toggle switches to enable/disable features.
		<br><strong>Tip:</strong> Resize window to test overflow behavior with content items. Check console for event logs.
		<br><strong>Themes:</strong> Switch between all 8 available themes (Horizon and Fiori 3 families, including dark and high contrast variants).
		<br><strong>Branding Mode:</strong> Switch between new Branding Slot and legacy Logo + Primary Title modes. Menu items only available in legacy mode.
	</div>

	<!-- ShellBar -->
	<div class="shellbar-container">
		<ui5-shellbar
			id="shellbar"
			secondary-title="Secondary Title"
		>
			<ui5-shellbar-branding slot="branding">
				Product Title
				<img src="https://upload.wikimedia.org/wikipedia/commons/5/59/SAP_2011_logo.svg" slot="logo"/>
			</ui5-shellbar-branding>

			<!-- Content Items -->
			<ui5-button slot="content" id="content-1">Action 1</ui5-button>
			<ui5-tag slot="content" color-scheme="7" id="content-2">Tag</ui5-tag>
			<ui5-button slot="content" id="content-3">Action 3</ui5-button>
			<ui5-button slot="content" id="content-4">End 1</ui5-button>
			<ui5-button slot="content" id="content-5">End 2</ui5-button>

			<ui5-avatar slot="profile" id="profile">
				<img src="https://sdk.openui5.org/test-resources/sap/f/images/Woman_avatar_01.png" />
			</ui5-avatar>

			<!-- Custom Items -->
			<ui5-shellbar-item icon="activities" text="Tasks" id="item-1"></ui5-shellbar-item>
			<ui5-shellbar-item icon="sys-help" text="Help" id="item-2"></ui5-shellbar-item>
		</ui5-shellbar>
	</div>

	<div class="spacer"></div>

	<script>
		const shellbar = document.getElementById('shellbar');

		const themeSelect = document.getElementById('themeSelect');
		const toggleNotifications = document.getElementById('toggleNotifications');
		const toggleProductSwitch = document.getElementById('toggleProductSwitch');
		const toggleSearchField = document.getElementById('toggleSearchField');
		const toggleProfile = document.getElementById('toggleProfile');
		const toggleAssistant = document.getElementById('toggleAssistant');
		const toggleItems = document.getElementById('toggleItems');
		const toggleMoreItems = document.getElementById('toggleMoreItems');
		const toggleStartButton = document.getElementById('toggleStartButton');
		const toggleContent = document.getElementById('toggleContent');
		const toggleSpacer = document.getElementById('toggleSpacer');
		const toggleSecondaryTitle = document.getElementById('toggleSecondaryTitle');
		const toggleMenuItems = document.getElementById('toggleMenuItems');
		const searchType = document.getElementById('searchType');
		const notificationsCount = document.getElementById('notificationsCount');
		const brandingMode = document.getElementById('brandingMode');

		// Theme selector
		themeSelect.addEventListener('ui5-change', (e) => {
			const theme = e.detail.selectedOption.value;
			console.log('Theme changed to:', theme);
			const Conf = window["sap-ui-webcomponents-bundle"].configuration;
			Conf.setTheme(theme);
		});

		// Element templates for dynamic creation
		const elementTemplates = {
			startButton: () => {
				const el = document.createElement('ui5-button');
				el.id = 'startButton';
				el.icon = 'nav-back';
				el.slot = 'startButton';
				return el;
			},
			assistant: () => {
				const el = document.createElement('ui5-toggle-button');
				el.id = 'assistant';
				el.icon = 'sap-icon://da';
				el.slot = 'assistant';
				return el;
			},
			searchField: () => {
				const el = document.createElement('ui5-input');
				el.id = 'searchField';
				el.placeholder = 'Search';
				el.slot = 'searchField';
				return el;
			},
			spacer: () => {
				const el = document.createElement('ui5-shellbar-spacer');
				el.id = 'spacer';
				el.slot = 'content';
				return el;
			},
			item3: () => {
				const el = document.createElement('ui5-shellbar-item');
				el.id = 'item-3';
				el.icon = 'action-settings';
				el.text = 'Settings';
				el.count = '3';
				return el;
			},
			item4: () => {
				const el = document.createElement('ui5-shellbar-item');
				el.id = 'item-4';
				el.icon = 'feedback';
				el.text = 'Feedback';
				return el;
			},
			menuItem1: () => {
				const el = document.createElement('ui5-li');
				el.id = 'menuItem-1';
				el.slot = 'menuItems';
				el.textContent = 'Dashboard';
				return el;
			},
			menuItem2: () => {
				const el = document.createElement('ui5-li');
				el.id = 'menuItem-2';
				el.slot = 'menuItems';
				el.textContent = 'Reports';
				return el;
			},
			menuItem3: () => {
				const el = document.createElement('ui5-li');
				el.id = 'menuItem-3';
				el.slot = 'menuItems';
				el.textContent = 'Settings';
				return el;
			},
			logo: () => {
				const el = document.createElement('img');
				el.id = 'logo';
				el.src = 'https://upload.wikimedia.org/wikipedia/commons/5/59/SAP_2011_logo.svg';
				el.slot = 'logo';
				return el;
			}
		};

		// Helper to toggle element in/out of DOM
		const elementCache = new Map();

		function toggleElement(id, show) {
			let el = document.getElementById(id);

			if (show) {
				if (!el) {
					// Check if we have a cached element first
					if (elementCache.has(id)) {
						const cache = elementCache.get(id);
						const { parent, nextSibling, element } = cache;
						if (nextSibling && nextSibling.parentNode === parent) {
							parent.insertBefore(element, nextSibling);
						} else {
							parent.appendChild(element);
						}
					} else {
						// Create element from template
						const templateKey = id.replace(/-/g, '');
						if (elementTemplates[templateKey]) {
							el = elementTemplates[templateKey]();

							// Special handling for spacer: insert after content-3 to split start/end groups
							if (id === 'spacer') {
								const insertAfter = document.getElementById('content-3');
								if (insertAfter && insertAfter.nextSibling) {
									shellbar.insertBefore(el, insertAfter.nextSibling);
								} else {
									shellbar.appendChild(el);
								}
							} else {
								shellbar.appendChild(el);
							}
						}
					}
				}
			} else {
				if (el) {
					elementCache.set(id, {
						parent: el.parentNode,
						nextSibling: el.nextSibling,
						element: el
					});
					el.remove();
				}
			}
		}

		// Notifications toggle
		toggleNotifications.addEventListener('ui5-change', (e) => {
			const checked = e.target.checked;
			shellbar.showNotifications = checked;
			console.log('Notifications:', checked);
		});

		// Product Switch toggle
		toggleProductSwitch.addEventListener('ui5-change', (e) => {
			const checked = e.target.checked;
			shellbar.showProductSwitch = checked;
			console.log('Product Switch:', checked);
		});

		// Search Field toggle
		toggleSearchField.addEventListener('ui5-change', (e) => {
			const checked = e.target.checked;
			shellbar.showSearchField = checked;
			toggleElement('searchField', checked);
			console.log('Search Field:', checked);
		});

		// Profile toggle
		toggleProfile.addEventListener('ui5-change', (e) => {
			const checked = e.target.checked;
			toggleElement('profile', checked);
			console.log('Profile:', checked);
		});

		// Assistant toggle
		toggleAssistant.addEventListener('ui5-change', (e) => {
			const checked = e.target.checked;
			toggleElement('assistant', checked);
			console.log('Assistant:', checked);
		});

		// Custom Items toggle
		toggleItems.addEventListener('ui5-change', (e) => {
			const checked = e.target.checked;
			toggleElement('item-1', checked);
			toggleElement('item-2', checked);
			console.log('Custom Items:', checked);
		});

		// More Items toggle
		toggleMoreItems.addEventListener('ui5-change', (e) => {
			const checked = e.target.checked;
			toggleElement('item-3', checked);
			toggleElement('item-4', checked);
			console.log('More Items:', checked);
		});

		// Start Button toggle
		toggleStartButton.addEventListener('ui5-change', (e) => {
			const checked = e.target.checked;
			toggleElement('startButton', checked);
			console.log('Start Button:', checked);
		});

		// Content Items toggle
		toggleContent.addEventListener('ui5-change', (e) => {
			const checked = e.target.checked;
			for (let i = 1; i <= 5; i++) {
				toggleElement(`content-${i}`, checked);
			}
			console.log('Content Items:', checked);
		});

		// Spacer toggle
		toggleSpacer.addEventListener('ui5-change', (e) => {
			const checked = e.target.checked;
			toggleElement('spacer', checked);
			console.log('Spacer:', checked);
		});

		// Secondary Title toggle
		toggleSecondaryTitle.addEventListener('ui5-change', (e) => {
			const checked = e.target.checked;
			shellbar.secondaryTitle = checked ? 'Secondary Title' : '';
			console.log('Secondary Title:', checked);
		});

		// Menu Items toggle
		toggleMenuItems.addEventListener('ui5-change', (e) => {
			const checked = e.target.checked;
			for (let i = 1; i <= 3; i++) {
				toggleElement(`menuItem-${i}`, checked);
			}
			console.log('Menu Items:', checked);
		});

		// Search Type selector
		searchType.addEventListener('ui5-change', (e) => {
			const value = e.detail.selectedOption.value;
			const searchVisible = toggleSearchField.checked;
			console.log('Search Type changed to:', value);

			// Helper to replace search field
			function replaceSearchField(oldId, newElement) {
				const oldEl = document.getElementById(oldId);
				const cache = elementCache.get(oldId);

				if (oldEl) {
					// Element is in DOM
					oldEl.replaceWith(newElement);
					if (!searchVisible) {
						toggleElement(oldId, false);
					}
				} else if (cache) {
					// Element is cached (not visible)
					cache.element = newElement;
					elementCache.set(oldId, cache);
				} else {
					// Element doesn't exist, add it
					shellbar.appendChild(newElement);
					if (!searchVisible) {
						toggleElement(oldId, false);
					}
				}
			}

			if (value === 'shellbar-search') {
				// Create ui5-shellbar-search element
				const newEl = document.createElement('ui5-shellbar-search');
				newEl.id = 'searchField';
				newEl.setAttribute('slot', 'searchField');
				newEl.setAttribute('placeholder', 'Search...');
				newEl.setAttribute('collapsed', '');

				replaceSearchField('searchField', newEl);
			} else {
				// Create ui5-input element
				const newEl = document.createElement('ui5-input');
				newEl.id = 'searchField';
				newEl.setAttribute('slot', 'searchField');
				newEl.setAttribute('placeholder', 'Search');

				replaceSearchField('searchField', newEl);
			}
		});

		// Notifications count input
		notificationsCount.addEventListener('ui5-input', (e) => {
			const value = e.target.value;
			shellbar.notificationsCount = value || undefined;
			console.log('Notifications Count:', value);
		});

		// Cache for branding element
		let cachedBranding = null;

		// Branding mode selector
		brandingMode.addEventListener('ui5-change', (e) => {
			const value = e.detail.selectedOption.value;
			console.log('Branding Mode changed to:', value);

			const isLegacy = value === 'legacy';

			// Enable/disable menu items toggle
			toggleMenuItems.disabled = !isLegacy;

			// If switching to branding mode, clear menu items
			if (!isLegacy && toggleMenuItems.checked) {
				toggleMenuItems.checked = false;
				for (let i = 1; i <= 3; i++) {
					toggleElement(`menuItem-${i}`, false);
				}
			}

			if (isLegacy) {
				// Switch to logo + primaryTitle mode
				// Cache and remove branding slot
				const branding = shellbar.querySelector('[slot="branding"]');

				console.log('Switching to legacy mode - branding:', branding);

				if (branding) {
					cachedBranding = branding;
					branding.remove();
				}

				// Add logo
				toggleElement('logo', true);

				// Ensure primaryTitle is set
				shellbar.primaryTitle = 'Product Title';

				console.log('Legacy mode set - logo:', shellbar.logo);
				console.log('Legacy mode set - title:', shellbar.primaryTitle);
			} else {
				// Switch to branding slot mode
				toggleElement('logo', false);

				// Restore cached branding or create new one
				if (cachedBranding) {
					shellbar.insertBefore(cachedBranding, shellbar.firstChild);
				} else {
					const newBranding = document.createElement('ui5-shellbar-branding');
					newBranding.slot = 'branding';
					newBranding.textContent = 'Product Title';
					const logoImg = document.createElement('img');
					logoImg.src = 'https://upload.wikimedia.org/wikipedia/commons/5/59/SAP_2011_logo.svg';
					logoImg.slot = 'logo';
					newBranding.appendChild(logoImg);
					shellbar.insertBefore(newBranding, shellbar.firstChild);
					cachedBranding = newBranding;
				}

				// Clear primaryTitle
				shellbar.primaryTitle = '';
			}
		});

		// Event listeners
		shellbar.addEventListener('ui5-notifications-click', (e) => {
			e.preventDefault();
			console.log('Notifications clicked', e.detail);
		});

		shellbar.addEventListener('ui5-profile-click', (e) => {
			console.log('Profile clicked', e.detail);
		});

		shellbar.addEventListener('ui5-product-switch-click', (e) => {
			console.log('Product Switch clicked', e.detail);
		});

		shellbar.addEventListener('ui5-search-button-click', (e) => {
			console.log('Search button clicked', e.detail);
		});

		shellbar.addEventListener('ui5-logo-click', (e) => {
			console.log('Logo clicked', e.detail);
		});

		shellbar.addEventListener('ui5-menu-item-click', (e) => {
			console.log('Menu item clicked', e.detail);
		});

		shellbar.addEventListener('ui5-content-item-visibility-change', (e) => {
			console.log('Content visibility changed:', e.detail.items.length, 'items hidden');
		});

		shellbar.addEventListener('ui5-search-field-toggle', (e) => {
			console.log('Search field toggled:', e.detail.expanded);
		});

		// Toggle assistant icon on click
		document.querySelectorAll('ui5-toggle-button').forEach(el => {
			el.addEventListener('click', (event) => {
				const toggleButton = event.target;
				toggleButton.icon = toggleButton.pressed ? 'sap-icon://da-2' : 'sap-icon://da';
			});
		});

		// Item click listeners
		const item1 = document.getElementById('item-1');
		const item2 = document.getElementById('item-2');
		if (item1) item1.addEventListener('click', (e) => console.log('Item 1 clicked', e.detail));
		if (item2) item2.addEventListener('click', (e) => console.log('Item 2 clicked', e.detail));

		// Attach listeners to dynamic items when they are added
		const observer = new MutationObserver((mutations) => {
			mutations.forEach((mutation) => {
				mutation.addedNodes.forEach((node) => {
					if (node.id === 'item-3') node.addEventListener('click', (e) => console.log('Item 3 clicked', e.detail));
					if (node.id === 'item-4') node.addEventListener('click', (e) => console.log('Item 4 clicked', e.detail));
				});
			});
		});

		observer.observe(shellbar, { childList: true });

		console.log('ShellBar Feature Toggle Page loaded');
		console.log('Open browser console to see event logs');
		console.log('Resize window to test overflow behavior!');
	</script>
</body>
</html>
