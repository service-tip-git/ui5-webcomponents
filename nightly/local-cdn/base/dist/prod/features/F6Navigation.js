"use strict";import{getFeature as m,registerFeature as d}from"../FeaturesRegistry.js";import{isF6Next as h,isF6Previous as f}from"../Keys.js";import{getFirstFocusableElement as g}from"../util/FocusableElements.js";import y from"../util/getFastNavigationGroups.js";import E from"../util/isElementClickable.js";import{getCurrentRuntimeIndex as w,compareRuntimes as v}from"../Runtimes.js";import l from"../getSharedResource.js";import p from"../util/getParentElement.js";const c=w(),F=a=>a===void 0?!0:v(c,a)===1;class r{constructor(){this.selectedGroup=null;this.groups=[];this.keydownHandler=this._keydownHandler.bind(this),this.attachEventListeners()}attachEventListeners(){document.addEventListener("keydown",this.keydownHandler)}removeEventListeners(){document.removeEventListener("keydown",this.keydownHandler)}async groupElementToFocus(e){if(e){if(E(e))return e;const t=await g(e);if(t)return t}}async findNextFocusableGroupElement(e){let t;for(let s=0;s<this.groups.length;s++){let o;if(e>-1?e+1>=this.groups.length?(e=0,o=this.groups[e]):(e+=1,o=this.groups[e]):(e=0,o=this.groups[e]),t=await this.groupElementToFocus(o),t)break}return t}async findPreviousFocusableGroupElement(e){let t;for(let s=0;s<this.groups.length;s++){let o;if(e>0){const u=await this.groupElementToFocus(this.groups[e]);let i=1;for(let n=1;n<this.groups.length&&await this.groupElementToFocus(this.groups[e-n])===u;n++)i++;e-=i,e<0&&(e=this.groups.length-1),o=this.groups[e]}else e=this.groups.length-1,o=this.groups[e];if(t=await this.groupElementToFocus(o),t)break}return t}async _keydownHandler(e){const t=m("OpenUI5Support");if(t&&t.isOpenUI5Detected()){this.destroy();return}const o=h(e),u=f(e);if(!(o||u)||(this.updateGroups(),this.groups.length<1))return;e.preventDefault();let i;if(this.groups.length===0)return i=await this.groupElementToFocus(this.groups[0]),i?.focus();let n=-1;this.selectedGroup&&(n=this.groups.indexOf(this.selectedGroup)),o&&(i=await this.findNextFocusableGroupElement(n)),u&&(i=await this.findPreviousFocusableGroupElement(n)),i?.focus()}updateGroups(){const e=this.findContainer();this.setSelectedGroup(),this.groups=y(e)}findContainer(){const e=window.document.querySelector("html");let t=this.deepActive(window.document);for(;t&&t!==e;){const s=t.closest("[data-sap-ui-fastnavgroup-container='true']");if(s)return s;t=p(t)}return document.body}setSelectedGroup(e=window.document){const t=window.document.querySelector("html");let s=this.deepActive(e);for(;s&&s.getAttribute("data-sap-ui-fastnavgroup")!=="true"&&s!==t;)s=p(s);this.selectedGroup=s}deepActive(e){return e?.activeElement?.shadowRoot?.activeElement?this.deepActive(e.activeElement.shadowRoot):e.activeElement}destroy(){this.removeEventListeners()}get _ui5RuntimeIndex(){return c}static init(){const e=l("F6Registry",{});e.instance?F(e.instance?._ui5RuntimeIndex)&&(e.instance?.destroy(),e.instance=new r):e.instance=new r}static destroy(){l("F6Registry",{}).instance?.destroy()}}d("F6Navigation",r);export default r;
//# sourceMappingURL=F6Navigation.js.map
