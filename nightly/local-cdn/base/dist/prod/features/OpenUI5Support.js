"use strict";import l from"./patchPatcher.js";import{patchPopup as u,addOpenedPopup as d,removeOpenedPopup as m,getTopmostPopup as p}from"./patchPopup.js";import{registerFeature as C}from"../FeaturesRegistry.js";import{setTheme as g}from"../config/Theme.js";import{secondaryBoot as f}from"../Boot.js";const h=100;class t{static{this.enablePolling=!1}static isAtLeastVersion116(){if(!window.sap.ui.version)return!0;const e=window.sap.ui.version.split(".");return!e||e.length<2?!1:parseInt(e[0])>1||parseInt(e[1])>=116}static isOpenUI5Detected(){return typeof window.sap?.ui?.require=="function"}static{this.OpenUI5DelayedInit=async()=>{t.init(),await f()}}static awaitForOpenUI5(){if(t.enablePolling){const a=setInterval(()=>{t.isOpenUI5Detected()&&(clearInterval(a),t.OpenUI5DelayedInit())},h)}else document.addEventListener("sap-ui-core-ready",()=>{t.OpenUI5DelayedInit()})}static init(){return t.isOpenUI5Detected()?(t.initPromise||(t.initPromise=new Promise(a=>{window.sap.ui.require(["sap/ui/core/Core"],async e=>{const i=()=>{let n=["sap/ui/core/Popup","sap/m/Dialog","sap/ui/core/Patcher","sap/ui/core/LocaleData"];t.isAtLeastVersion116()&&(n=[...n,"sap/base/i18n/Formatting","sap/base/i18n/Localization","sap/ui/core/ControlBehavior","sap/ui/core/Theming","sap/ui/core/date/CalendarUtils"]),window.sap.ui.require(n,(o,r,s)=>{l(s),u(o,r),a()})};t.isAtLeastVersion116()?(await e.ready(),i()):e.attachInit(i)})})),t.initPromise):t.awaitForOpenUI5()}static getConfigurationSettingsObject(){if(!t.isOpenUI5Detected())return{};if(t.isAtLeastVersion116()){const n=window.sap.ui.require("sap/ui/core/ControlBehavior"),o=window.sap.ui.require("sap/base/i18n/Localization"),r=window.sap.ui.require("sap/ui/core/Theming"),s=window.sap.ui.require("sap/base/i18n/Formatting"),c=window.sap.ui.require("sap/ui/core/date/CalendarUtils");return{animationMode:n.getAnimationMode(),language:o.getLanguage(),theme:r.getTheme(),themeRoot:r.getThemeRoot(),rtl:o.getRTL(),timezone:o.getTimezone(),calendarType:s.getCalendarType(),formatSettings:{firstDayOfWeek:c.getWeekConfigurationValues().firstDayOfWeek,legacyDateCalendarCustomizing:s.getCustomIslamicCalendarData?.()??s.getLegacyDateCalendarCustomizing?.()}}}const e=window.sap.ui.require("sap/ui/core/Core").getConfiguration(),i=window.sap.ui.require("sap/ui/core/LocaleData");return{animationMode:e.getAnimationMode(),language:e.getLanguage(),theme:e.getTheme(),themeRoot:typeof e.getThemeRoot=="function"?e.getThemeRoot():void 0,rtl:e.getRTL(),timezone:typeof e.getTimezone=="function"?e.getTimezone():void 0,calendarType:e.getCalendarType(),formatSettings:{firstDayOfWeek:i?i.getInstance(e.getLocale()).getFirstDayOfWeek():void 0,legacyDateCalendarCustomizing:e.getFormatSettings().getLegacyDateCalendarCustomizing()}}}static getLocaleDataObject(){if(!t.isOpenUI5Detected())return;const a=window.sap.ui.require("sap/ui/core/LocaleData");if(t.isAtLeastVersion116()){const n=window.sap.ui.require("sap/base/i18n/Localization");return a.getInstance(n.getLanguageTag())._get()}const i=window.sap.ui.require("sap/ui/core/Core").getConfiguration();return a.getInstance(i.getLocale())._get()}static _listenForThemeChange(){if(t.isAtLeastVersion116()){const a=window.sap.ui.require("sap/ui/core/Theming");a.attachApplied(()=>{g(a.getTheme())})}else{const a=window.sap.ui.require("sap/ui/core/Core"),e=a.getConfiguration();a.attachThemeChanged(()=>{g(e.getTheme())})}}static attachListeners(){return t.isOpenUI5Detected()?(t._listenForThemeChange(),!0):!1}static cssVariablesLoaded(){if(!t.isOpenUI5Detected())return;const a=[...document.head.children].find(e=>e.id==="sap-ui-theme-sap.ui.core");return a?!!a.href.match(/\/css(-|_)variables\.css/)||!!a.href.match(/\/library\.css/):!1}static addOpenedPopup(a){d(a)}static removeOpenedPopup(a){m(a)}static getTopmostPopup(){return p()}}C("OpenUI5Support",t);export default t;
//# sourceMappingURL=OpenUI5Support.js.map
