"use strict";import u from"../getSharedResource.js";import y from"./insertOpenUI5PopupStyles.js";const p=u("AllOpenedPopupsRegistry",{openedRegistry:[]}),i=e=>{p.openedRegistry.push(e)},a=e=>{const o=p.openedRegistry.findIndex(t=>t.instance===e);o===p.openedRegistry.length-1&&I(),o>-1&&p.openedRegistry.splice(o,1)},c=()=>p.openedRegistry.length===0?null:p.openedRegistry[p.openedRegistry.length-1].instance,l=e=>{for(let o=p.openedRegistry.length-1;o>=0;o--){const t=p.openedRegistry[o];if(t.type==="WebComponent")return!0;if(t.instance===e)break}return!1},s=e=>{const o=e.getContent();return o instanceof HTMLElement?o:o?.getDomRef()||null},d=e=>{if(!["OPENING","OPEN"].includes(e.getOpenState())||!r())return;const t=s(e);if(!t)return;const n=document.getElementById("sap-ui-blocklayer-popup");e.getModal()&&n&&(n.setAttribute("popover","manual"),n.hidePopover(),n.showPopover()),t.setAttribute("popover","manual"),t.showPopover()},g=e=>{const o=s(e);if(o&&(o.hasAttribute("popover")&&(o.hidePopover(),o.removeAttribute("popover")),c()===e&&e.getModal())){const t=document.getElementById("sap-ui-blocklayer-popup");t&&t.hasAttribute("popover")&&t.hidePopover()}},I=()=>{if(!r())return;const e=p.openedRegistry[p.openedRegistry.length-2];if(!e||e.type!=="OpenUI5"||!e.instance.getModal())return;const o=s(e.instance),t=document.getElementById("sap-ui-blocklayer-popup");o?.hidePopover(),t?.showPopover(),o?.showPopover()},r=(e=document)=>e.querySelector(":popover-open")?!0:Array.from(e.querySelectorAll("*")).some(o=>{const t=o.shadowRoot;return t&&r(t)}),P=e=>{const o=e.prototype.onsapescape;e.prototype.onsapescape=function(...n){l(this.oPopup)||o.apply(this,n)}},h=e=>{const o=e.prototype.open;e.prototype.open=function(...n){o.apply(this,n),d(this),i({type:"OpenUI5",instance:this})}},O=e=>{const o=e.prototype._closed;e.prototype._closed=function(...n){g(this),o.apply(this,n),a(this)}},f=e=>{const o=e.prototype.onFocusEvent;e.prototype.onFocusEvent=function(...n){l(this)||o.apply(this,n)}},v=()=>{const e=new CSSStyleSheet;e.replaceSync(".sapMPopup-CTX:popover-open { inset: unset; }"),document.adoptedStyleSheets=[...document.adoptedStyleSheets,e]},m=(e,o)=>{y(),h(e),O(e),v(),f(e),P(o)};export{m as patchPopup,i as addOpenedPopup,a as removeOpenedPopup,c as getTopmostPopup};
//# sourceMappingURL=patchPopup.js.map
